{% extends "base.html" %}
{% block title %}Home Map{% endblock %}

{% block content %}
<div class="home-container">
    <h2 class="text-center mb-4" style="font-weight: 700; color: #212529; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">ğŸš¨ Report an Animal Incident</h2>
    <div class="home-row">
        <div>
            <div id="map"></div>
        </div>
        <div>
            <div class="report-panel">
                <h5 class="mb-3" style="font-weight: 600; color: #495057;">ğŸ“ Incident Details</h5>
            <p class="small text-muted" style="font-size: 0.95rem; margin-bottom: 15px;">ğŸ“ Use your current location or click on the map to set location.</p>
        <form id="reportForm" action="/report" method="POST" enctype="multipart/form-data">
            <input type="hidden" id="latitude" name="latitude" required>
            <input type="hidden" id="longitude" name="longitude" required>

            <div class="mb-3">
                <button type="button" id="useLocationBtn" class="btn btn-info btn-sm w-100 mb-2" style="padding: 8px; font-weight: 600;">ğŸ“ Use My Current Location</button>
                <p id="locationStatus" class="status-text small text-center" style="margin: 0; color: #6c757d;">Please provide a location.</p>
            </div>
            <div class="mb-2">
                <label for="reporter_email" class="form-label">Your Email:<sup style="color:red;">*</sup></label>
                <input type="email" id="reporter_email" name="reporter_email" class="form-control" placeholder="your-email@example.com" required>
                <small class="text-muted">We'll send you updates about this report</small>
            </div>
            <div class="mb-2">
                <label for="animal_type" class="form-label">Animal Type:</label>
                <select id="animal_type" name="animal_type" class="form-select" required>
                    <option selected disabled value="">Choose...</option>
                    <option value="Dog">Dog</option>
                    <option value="Cat">Cat</option>
                    <option value="Cattle">Cattle</option>
                    <option value="Monkey">Monkey</option>
                    <option value="Deer">Deer</option>
                    <option value="Bird">Bird</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>
            <div class="mb-2">
                <label for="condition" class="form-label">Condition:</label>
                <select id="condition" name="condition" class="form-select" required>
                    <option selected disabled value="">Choose...</option>
                    <option value="Injured-Mobile">Injured - Mobile</option>
                    <option value="Injured-Immobile">Injured - Immobile</option>
                    <option value="Deceased">Deceased</option>
                </select>
            </div>
            <div class="mb-2">
                <label for="image" class="form-label">Animal Image:</label>
                <div class="btn-group w-100 mb-2" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('image').click()">ğŸ“ Upload</button>
                    <button type="button" class="btn btn-outline-primary" onclick="openCamera()">ğŸ“· Capture</button>
                </div>
                <input type="file" id="image" name="image" class="form-control d-none" accept="image/*">
                <video id="camera" style="display:none; width:100%; border-radius:8px; margin-top:10px;" autoplay></video>
                <canvas id="canvas" style="display:none;"></canvas>
                <img id="preview" style="display:none; width:100%; border-radius:8px; margin-top:10px;" />
                <button type="button" id="captureBtn" class="btn btn-success w-100 mt-2" style="display:none;" onclick="captureImage()">âœ”ï¸ Capture Photo</button>
                <button type="button" id="retakeBtn" class="btn btn-warning w-100 mt-2" style="display:none;" onclick="retakePhoto()">ğŸ”„ Retake</button>
            </div>
            <div class="mb-2">
                <label for="description" class="form-label">Brief Description:</label>
                <textarea id="description" name="description" class="form-control" rows="2"></textarea>
            </div>
                <button type="submit" id="submitBtn" class="btn btn-success mt-3 w-100" disabled>ğŸ“¤ Submit Report</button>
            </form>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}