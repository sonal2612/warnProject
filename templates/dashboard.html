{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 style="font-weight: 700; color: #212529;">üõ°Ô∏è Responder Dashboard</h2>
        <span class="badge bg-primary" style="font-size: 1rem; padding: 10px 15px;">Welcome, {{ current_user.username }}!</span>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th style="border-top-left-radius: 7px;">ID</th>
                    <th>Date and Time</th>
                    <th>Animal</th>
                    <th>AI Suggestion</th>
                    <th>Condition</th>
                    <th>Image</th>
                    <th>Status</th>
                    <th>Responder</th>
                    <th style="border-top-right-radius: 7px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>{{ report.id }}</td>
                    <td>{{ report.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ report.animal_type }}</td>
                    <td>
                        {% if report.ai_species_suggestion %}
                            <span class="badge bg-info text-dark">{{ report.ai_species_suggestion }}</span>
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ report.condition }}</td>
                    <td>
                        {% if report.image_filename %}
                            <button class="btn btn-sm btn-info" onclick="showImage('{{ url_for('static', filename='uploads/' + report.image_filename) }}')">üëÅÔ∏è View</button>
                        {% else %}
                            <span class="text-muted">No image</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if report.status == 'New' %}
                            <span class="badge bg-danger">{{ report.status }}</span>
                        {% elif report.status == 'Acknowledged' %}
                            <span class="badge bg-warning text-dark">{{ report.status }}</span>
                        {% else %}
                            <span class="badge bg-success">{{ report.status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ report.responder.username if report.responder else 'Unclaimed' }}</td>
                    <td>
                        {% if report.status == 'New' %}
                            <form method="POST" action="{{ url_for('claim_report', report_id=report.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-primary btn-sm" style="border-radius: 6px; padding: 5px 12px; font-weight: 600;">‚úÖ Claim</button>
                            </form>
                        {% elif report.status == 'Acknowledged' and report.responder_id == current_user.id %}
                            <a href="{{ url_for('resolve_report', report_id=report.id) }}" class="btn btn-success btn-sm" style="border-radius: 6px; padding: 5px 12px; font-weight: 600;">‚úîÔ∏è Resolve</a>
                        {% else %}
                            <span class="text-muted" style="font-size: 0.9rem;">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="9" class="text-center">No reports found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Incident Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage" src="" style="max-width: 100%; border-radius: 10px;">
            </div>
        </div>
    </div>
</div>

<script>
function showImage(imageUrl) {
    document.getElementById('modalImage').src = imageUrl;
    new bootstrap.Modal(document.getElementById('imageModal')).show();
}
</script>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}